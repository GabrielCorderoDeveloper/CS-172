By the way, i have made some changes to the code
1-optimization
2-made a function to handle all the events